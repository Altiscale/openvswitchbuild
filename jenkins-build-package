#!/bin/sh
pushd ${WORKSPACE}
envsubst < Dockerfile-autoconf > Dockerfile
docker build -t autoconf .
container_with_env=`docker run -d -e WORKSPACE=$WORKSPACE -e RELEASE=$BUILD_NUMBER -e PACKAGE_VERSION=$PACKAGE_VERSION -e HOME=/root autoconf`
docker commit ${container_with_env} autoconf-env
envsubst < Dockerfile-ovs > Dockerfile
docker build -t ovs .
CID=`docker run -d ovs true`
docker cp $CID:/root/rpmbuild/RPMS $PWD
chmod -R a+w RPMS
mv RPMS/x86_64/* ${WORKSPACE}
docker rm -f $CID
popd
